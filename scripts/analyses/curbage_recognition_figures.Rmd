---
title: "Curbage Recognition Experiment Figures"
output: html_notebook
---

### Angelique I. Delarazan
#### 01/31/2022
Generates figures for the curbage paper:
1. Performs two-way ANOVAs on target recognition and lure (2 x 2 ANOVA: Domain Type [Narrarive v. Perceptual] x Age [Older v. Younger])
2. Calculates correlations between neuropsychological tests and target recognition & lure performance
3. Split on MoCA: Incorporate a test of cognitive abilities in Analysis #1 above

Note: Statistical analyses completed using Python (see jupyter notebooks: curbage_recognition_analysis_01.ipynb and curbage_recognition_analysis_02.ipynb)

Set Up
```{r}
#Import Libraries
library(tidyverse)
library(readxl)
library(ggplot2)
library(readxl)
library(ggsignif)
library(dplyr)
library(magrittr)
library(ggbeeswarm)
library(Hmisc)
library(ggpubr)
library(rstatix)
```

```{r}
recognition = read_excel("/Volumes/GAMMA/curbage_recognition/data/sub-all_group-all_task-recognition_desc-all_results_neuropsych.xlsx")
recognition$subject = as.factor(recognition$subject)
recognition$group = as.factor(recognition$group)
recognition$type = as.factor(recognition$type)
recognition$LDI = as.numeric(recognition$LDI)
recognition$group_type = as.factor(recognition$group_type)
recognition$MoCA_type = as.factor(recognition$MoCA_type)
recognition$dprime = as.numeric(recognition$dprime)
```

Figure 2a. Swarmplot of dprime for all subjects.
Export with following dimensions: 1000(W) x 800 (L)
```{r}
#dprime

dprime_all = recognition %>% 
  ggplot(aes(x = type, group = group, y = dprime, col = group)) +
  ylab("Target Recognition (d')
       ") + xlab("") + labs(title = "") + 
  #coord_cartesian(ylim = c(0, 1.10)) +
  geom_beeswarm(dodge.width = 1, size = 5, alpha = 0.8) +
  stat_summary(fun = mean, na.rm = TRUE, 
               geom = "point",
               size = 3, color = "black", 
               position = position_dodge(width = 1)) +
  stat_summary(fun.data = mean_cl_normal, na.rm = TRUE, 
               geom = "errorbar", width = 0.2, color = "black",
               position = position_dodge(width = 1),
               size = 1) +
  scale_color_manual("group",values = c("older"="#da7b5e","younger"="#5d747c"), labels = c("older"="Older","younger"="Younger")) +
  theme(legend.position = "none", 
        plot.title = element_text(size = 48),   
        axis.text.y = element_text(size = 32), 
        axis.text.x = element_text(size = 32),
        axis.title = element_text(size = 32),
        legend.text=element_text(size=24),
        legend.title = element_blank())+ 
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
```

Figure 2b. Swarmplot of LDI for all subjects.

```{r}
#LDI

LDI_all = recognition %>% 
  ggplot(aes(x = type, group = group, y = LDI, col = group)) +
  ylab("Lure Recognition Rate (LDI)
       ") + xlab("") + labs(title = "") + 
  coord_cartesian(ylim = c(0, 1.1)) +
  geom_beeswarm(dodge.width = 1, size = 5, alpha = 0.8) +
  stat_summary(fun = mean, na.rm = TRUE, 
               geom = "point",
               size = 3, color = "black", 
               position = position_dodge(width = 1)) +
  stat_summary(fun.data = mean_se, na.rm = TRUE, 
               geom = "errorbar", width = 0.2, color = "black",
               position = position_dodge(width = 1),
               size = 1) +
  scale_color_manual("group",values = c("older"="#da7b5e","younger"="#5d747c"), labels = c("older"="Older","younger"="Younger")) +
  geom_signif(y_position = c(1), 
            xmin = c(1.8), xmax = c(2.2),
            size = 1,
            annotation = c("**"), tip_length = 0, textsize = 12, color = "black") +
  theme(legend.position = "none", 
        plot.title = element_text(size = 48),   
        axis.text.y = element_text(size = 32), 
        axis.text.x = element_text(size = 32),
        axis.title = element_text(size = 32),
        legend.text=element_text(size=24),
        legend.title = element_blank())+ 
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
```

```{r}
ggarrange(dprime_all, '', LDI_all, ncol = 3, widths = c(1, .2, 1))
```


Figure 3a. Swarmplot of LDI split by MoCA score.
Read in "low" scores 

```{r}
recognition = read_excel("/Volumes/GAMMA/curbage_recognition/data/sub-all_group-all_task-recognition_desc-all_results_neuropsych_MoCA.xlsx")
recognition$subject = as.factor(recognition$subject)
recognition$group = as.factor(recognition$group)
recognition$type = as.factor(recognition$type)
recognition$LDI = as.numeric(recognition$LDI)
recognition$group_type = as.factor(recognition$group_type)
recognition$MoCA_type = as.factor(recognition$MoCA_type)
recognition$dprime = as.numeric(recognition$dprime)
```
```{r}

dprime_low = recognition[(recognition$MoCA_type=="low"),] %>% 
  ggplot(aes(x = type, group = group, y = dprime, col = group)) +
  ylab("Target Recognition (d')
       ") + xlab("") + labs(title = "", subtitle = "Younger vs. Low MoCA Score Older") + 
  #coord_cartesian(ylim = c(0, 1.10)) +
  geom_beeswarm(dodge.width = 1, size = 5, alpha = 0.8) +
  stat_summary(fun = mean, na.rm = TRUE, 
               geom = "point",
               size = 3, color = "black", 
               position = position_dodge(width = 1)) +
  stat_summary(fun.data = mean_se, na.rm = TRUE, 
               geom = "errorbar", width = 0.2, color = "black",
               position = position_dodge(width = 1),
               size = 1) +
  scale_color_manual("group",values = c("older"="#da7b5e","younger"="#5d747c"), labels = c("older"="Older","younger"="Younger")) +
  theme(legend.position = "none", 
        plot.title = element_text(size = 48),   
        axis.text.y = element_text(size = 32), 
        axis.text.x = element_text(size = 32),
        axis.title = element_text(size = 32),
        legend.text=element_text(size=24),
        legend.title = element_blank(), 
        plot.subtitle = element_text(hjust=0.5, size = 30, color = 'grey28'),
        )+
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
```
```{r}

dprime_high = recognition[(recognition$MoCA_type=="high"),] %>% 
  ggplot(aes(x = type, group = group, y = dprime, col = group)) +
  ylab("") + xlab("") + labs(title = "", subtitle = "Younger vs. High MoCA Score Older") + 
  #coord_cartesian(ylim = c(0, 1.10)) +
  geom_beeswarm(dodge.width = 1, size = 5, alpha = 0.8) +
  stat_summary(fun = mean, na.rm = TRUE, 
               geom = "point",
               size = 3, color = "black", 
               position = position_dodge(width = 1)) +
  stat_summary(fun.data = mean_se, na.rm = TRUE, 
               geom = "errorbar", width = 0.2, color = "black",
               position = position_dodge(width = 1),
               size = 1) +
  scale_color_manual("group",values = c("older"="#da7b5e","younger"="#5d747c"), labels = c("older"="Older","younger"="Younger")) +
  theme(legend.position = "none", 
        plot.title = element_text(size = 48),   
        axis.text.y = element_text(size = 32), 
        axis.text.x = element_text(size = 32),
        axis.title = element_text(size = 32),
        legend.text=element_text(size=24),
        legend.title = element_blank(), 
        plot.subtitle = element_text(hjust=0.5, size = 30, color = 'grey28'),
        )+
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
```
```{r}
ggarrange(dprime_low, dprime_high)
```
LDI 
```{r}

LDI_low = recognition[(recognition$MoCA_type=="low"),] %>% 
  ggplot(aes(x = type, group = group, y = LDI, col = group)) +
  ylab("Lure Recognition Rate (LDI)
       ") + xlab("") + labs(title = "", subtitle = "Younger vs. Low MoCA Score Older") + 
  coord_cartesian(ylim = c(0, 1.10)) +
  geom_beeswarm(dodge.width = 1, size = 5, alpha = 0.8) +
  stat_summary(fun = mean, na.rm = TRUE, 
               geom = "point",
               size = 3, color = "black", 
               position = position_dodge(width = 1)) +
  stat_summary(fun.data = mean_se, na.rm = TRUE, 
               geom = "errorbar", width = 0.2, color = "black",
               position = position_dodge(width = 1),
               size = 1) +
  scale_color_manual("group",values = c("older"="#da7b5e","younger"="#5d747c"), labels = c("older"="Older","younger"="Younger")) +
  geom_signif(y_position = c(1), 
          xmin = c(1.8), xmax = c(2.2),
          size = 1,
          annotation = c("**"), tip_length = 0, textsize = 12, color = "black") +
  theme(legend.position = "none", 
        plot.title = element_text(size = 48),   
        axis.text.y = element_text(size = 32), 
        axis.text.x = element_text(size = 32),
        axis.title = element_text(size = 32),
        legend.text=element_text(size=24),
        legend.title = element_blank(), 
        plot.subtitle = element_text(hjust=0.5, size = 28, color = 'grey28'),
        )+
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
```

```{r}
LDI_low
```

```{r}

LDI_high = recognition[(recognition$MoCA_type=="high"),] %>% 
  ggplot(aes(x = type, group = group, y = LDI, col = group)) +
  ylab("") + xlab("") + labs(title = "", subtitle = "Younger vs. High MoCA Score Older") + 
  coord_cartesian(ylim = c(0, 1.10)) +
  geom_beeswarm(dodge.width = 1, size = 5, alpha = 0.8) +
  stat_summary(fun = mean, na.rm = TRUE, 
               geom = "point",
               size = 3, color = "black", 
               position = position_dodge(width = 1)) +
  stat_summary(fun.data = mean_se, na.rm = TRUE, 
               geom = "errorbar", width = 0.2, color = "black",
               position = position_dodge(width = 1),
               size = 1) +
  scale_color_manual("group",values = c("older"="#da7b5e","younger"="#5d747c"), labels = c("older"="Older","younger"="Younger")) +
  theme(legend.position = "none", 
        plot.title = element_text(size = 48),   
        axis.text.y = element_text(size = 32), 
        axis.text.x = element_text(size = 32),
        axis.title = element_text(size = 32),
        legend.text=element_text(size=24),
        legend.title = element_blank(), 
        plot.subtitle = element_text(hjust=0.5, size = 28, color = 'grey28'),
        )+
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
```

```{r}
LDI_high
```

```{r}
ggarrange(LDI_low, LDI_high)
```

```{r}
legend = recognition[(recognition$MoCA_type=="high"),] %>% 
  ggplot(aes(x = type, group = group, y = LDI, col = group)) +
  ylab("") + xlab("") + labs(title = "", subtitle = "Younger vs. High MoCA Score Older") + 
  coord_cartesian(ylim = c(0, 1.10)) +
  geom_beeswarm(dodge.width = 1, size = 5, alpha = 0.8) +
  stat_summary(fun = mean, na.rm = TRUE, 
               geom = "point",
               size = 3, color = "black", 
               position = position_dodge(width = 1)) +
  stat_summary(fun.data = mean_se, na.rm = TRUE, 
               geom = "errorbar", width = 0.2, color = "black",
               position = position_dodge(width = 1),
               size = 1) +
  scale_color_manual("group",values = c("older"="#da7b5e","younger"="#5d747c"), labels = c("older"="Older   ","younger"="Younger")) +
  theme(legend.position = "top", 
        plot.title = element_text(size = 48),   
        axis.text.y = element_text(size = 32), 
        axis.text.x = element_text(size = 32),
        axis.title = element_text(size = 32),
        legend.text=element_text(size=24),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust=0.5, size = 28, color = 'grey28')
        )+
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
```


```{r}
my_legend <- get_legend(legend)
as_ggplot(my_legend)
```





```{r}
#LDI


facet_grid_label = c('high' = "High MoCA Score", 'low'="Low MoCA Score")

recognition %>% 
  ggplot(aes(x = type, group = group, y = LDI, col = group)) +
  ylab("LDI") + xlab("") + labs(title = "") + 
  coord_cartesian(ylim = c(0, 1.10)) +
  geom_beeswarm(dodge.width = 1, size = 3, alpha = 0.8) +
  stat_summary(fun = mean, na.rm = TRUE, 
               geom = "point",
               size = 1.5, color = "black", 
               position = position_dodge(width = 1)) +
  stat_summary(fun.data = mean_se, na.rm = TRUE, 
               geom = "errorbar", width = 0.15, color = "black",
               position = position_dodge(width = 1)) +
  scale_color_manual("group",values = c("older"="#da7b5e","younger"="#5d747c"), labels = c("older"="Older","younger"="Younger")) +
  facet_wrap(MoCA_type~ ., labeller = as_labeller(facet_grid_label))+
  geom_signif(y_position = c(1), 
            xmin = c(1.8), xmax = c(2.2),
            annotations = c("**"), tip_length = 0, textsize = 8, color = "black") +
  theme(legend.position = "right", 
        plot.title = element_text(size = 32), 
        axis.text.y = element_text(size = 24), 
        axis.text.x = element_text(size = 24),
        axis.title = element_text(size = 24),
        legend.text=element_text(size=16),
        legend.title = element_blank())+ 
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
```
```{r}
#LDI

facet_grid_label = c('high' = "High MoCA Score", 'low'="Low MoCA Score")

LDI_df = recognition %>% 
  ggplot(aes(x = type, group = group, y = LDI, col = group)) +
  ylab("LDI") + xlab("") + labs(title = "") + 
  coord_cartesian(ylim = c(0, 1.10)) +
  geom_beeswarm(dodge.width = 1, size = 3, alpha = 0.8) +
  stat_summary(fun = mean, na.rm = TRUE, 
               geom = "point",
               size = 1.5, color = "black", 
               position = position_dodge(width = 1)) +
  stat_summary(fun.data = mean_se, na.rm = TRUE, 
               geom = "errorbar", width = 0.15, color = "black",
               position = position_dodge(width = 1)) +
  scale_color_manual("group",values = c("older"="#da7b5e","younger"="#5d747c"), labels = c("older"="Older","younger"="Younger")) +
  facet_wrap(MoCA_type~ ., labeller = as_labeller(facet_grid_label))+
  theme(legend.position = "right", 
        plot.title = element_text(size = 32), 
        axis.text.y = element_text(size = 24), 
        axis.text.x = element_text(size = 24),
        axis.title = element_text(size = 24),
        legend.text=element_text(size=16),
        legend.title = element_blank())+ 
  scale_x_discrete(labels=c("narrative"="Narrative", "perceptual"="Perceptual")) 
```

```{r}
LDI_df + stat_pvalue_manual(
    stat.test, bracket.nudge.y = -2, hide.ns = TRUE,
    label = "{p.adj}{p.adj.signif}"
    ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.1)))
```


